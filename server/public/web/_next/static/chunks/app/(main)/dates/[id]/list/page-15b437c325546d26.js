(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[524],{93337:function(){},28103:function(){},18403:function(e,s,t){Promise.resolve().then(t.bind(t,84691))},58075:function(e,s,t){"use strict";t.d(s,{R:function(){return r},s:function(){return i}});let r=async e=>{let{queryKey:s}=e;try{let e=await fetch("".concat("http://localhost:4060").concat(s[0]));if(!e.ok)throw Error("Something went wrong ".concat(s[0]));return await e.json()}catch(e){throw Error(e)}},i=(e,s)=>async t=>{try{let r=await fetch("".concat("http://localhost:4060").concat(e),{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw Error("Something went wrong ".concat(s," ").concat(e));return await r.json()}catch(e){throw Error(e)}}},84691:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return I}});var r=t(33584),i=t(58075),n=t(43070),a=t(82733),l=t(78502),c=t(54921),o=t(57912),d=t(10),u=t(27272),m=t(26907),h=t(65325),x=t(46008),f=t(67930),j=t(56132),p=t(78225),y=t(28938),g=t(23137),v=t.n(g),F=t(13920),N=t(49829),w=t(86198),S=t(88912),k=t(82246),Z=t(79037),b=t(81288),A=t(41794),C=e=>{let{isOpen:s,onOpenChange:t,form:n,fields:a,id:c}=e,[o,d]=y.ZP.useMessage(),u=(0,m.NL)(),{mutate:x}=(0,h.D)({mutationFn:(0,i.s)("/dates/".concat(c),"post"),onSuccess:()=>{u.invalidateQueries({queryKey:["/dates/".concat(c)]})}});return(0,r.jsxs)(r.Fragment,{children:[d,(0,r.jsx)(N.R,{isOpen:s,placement:"center",scrollBehavior:"inside",onOpenChange:t,children:(0,r.jsx)(w.A,{children:e=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(S.k,{className:"flex flex-col gap-1",children:"添加数据"}),(0,r.jsx)(k.I,{children:(0,r.jsx)(f.Z,{form:n,layout:"vertical",children:null==a?void 0:a.map(e=>(0,r.jsx)(f.Z.Item,{label:e.fieldName,name:e.fieldName,rules:[{required:!0,message:"请输入".concat(e.fieldName)}],children:"number"===e.fieldType?(0,r.jsx)(Z.Y,{type:e.fieldType}):(0,r.jsx)(A.Z,{rows:3})}))})}),(0,r.jsxs)(b.R,{children:[(0,r.jsx)(l.A,{color:"danger",variant:"light",onPress:()=>{n.resetFields(),e()},children:"取消"}),(0,r.jsx)(l.A,{color:"primary",onPress:()=>{n.validateFields().then(s=>{x(s,{onSuccess(){o.success("添加成功",1),n.resetFields(),e()},onError(e){o.error(e.message,1)}})})},children:"添加"})]})]})})})]})},E=t(39275),q=t(20647),O=t(20581);let{TextArea:P}=O.default;var z=e=>{let{id:s,updateId:t,open:n,form:a,fields:c,setOpen:o}=e,[d,u]=y.ZP.useMessage(),x=(0,m.NL)(),{mutate:j}=(0,h.D)({mutationFn:e=>(0,i.s)("/dates/".concat(s,"/").concat(e.id),"put")(e.values)});return(0,r.jsxs)(r.Fragment,{children:[u,(0,r.jsx)(E.Z,{title:"修改数据",width:"40%",onClose:()=>{a.resetFields(),o(!1)},open:n,bodyStyle:{paddingBottom:80},extra:(0,r.jsxs)(q.default,{children:[(0,r.jsx)(l.A,{onClick:()=>{a.resetFields(),o(!1)},size:"sm",color:"danger",variant:"light",children:"取消"}),(0,r.jsx)(l.A,{color:"primary",size:"sm",onClick:()=>{a.validateFields().then(e=>{j({id:t,values:e},{onSuccess(){x.invalidateQueries({queryKey:["/dates/".concat(s)]}),o(!1),a.resetFields(),d.success("更新成功",1)},onError(e){d.error(e.message,1)}})})},children:"确定"})]}),children:(0,r.jsx)(f.Z,{form:a,layout:"vertical",children:null==c?void 0:c.map(e=>(0,r.jsx)(f.Z.Item,{label:e.fieldName,name:e.fieldName,rules:[{required:!0,message:"请输入".concat(e.fieldName)}],children:"number"===e.fieldType?(0,r.jsx)(O.default,{type:e.fieldType}):(0,r.jsx)(P,{rows:3})}))})})]})},K=t(75478),T=t(40499),L=t(84353),_=e=>{let{open:s,setOpen:t,fields:n,id:c}=e,[o,d]=(0,F.useState)([]),[u]=f.Z.useForm(),{isOpen:x,onOpen:j,onOpenChange:p}=(0,a.q)(),g=(0,m.NL)(),[v,Z]=y.ZP.useMessage(),{mutate:A}=(0,h.D)({mutationFn:e=>(0,i.s)("/dates/".concat(c,"/import"),"post")(e),onSuccess(){g.invalidateQueries({queryKey:["/dates/".concat(c)]}),g.invalidateQueries({queryKey:["/default/".concat(c)]}),v.success("导入成功",1)},onError(e){v.error(e.message,1)}}),{mutate:C}=(0,h.D)({mutationFn:e=>(0,i.s)("/dates/".concat(c,"/force_import"),"post")(e),onError(e){v.error(e.message,1)}}),{mutate:O}=(0,h.D)({mutationFn:e=>(0,i.s)("/default/".concat(c),"put")(e),onSuccess(){g.invalidateQueries({queryKey:["/dates/".concat(c)]}),g.invalidateQueries({queryKey:["/default/".concat(c)]}),v.success("导入成功",1)},onError(e){v.error(e.message,1)}}),[P,z]=(0,F.useState)();return(0,r.jsxs)(r.Fragment,{children:[Z,(0,r.jsx)(E.Z,{title:"导入数据",width:"40%",onClose:()=>{t(!1)},open:s,placement:"left",bodyStyle:{paddingBottom:80},extra:(0,r.jsxs)(q.default,{children:[(0,r.jsx)(l.A,{onClick:()=>{t(!1),u.resetFields()},size:"sm",color:"danger",variant:"light",children:"取消"}),(0,r.jsx)(l.A,{color:"primary",size:"sm",onClick:async()=>{var e;let s=await u.validateFields(),r=await (e=s.file[0].originFileObj,new Promise((s,t)=>{let r=new FileReader;r.onload=e=>{var t;let r=null===(t=e.target)||void 0===t?void 0:t.result,i=K.ij(r,{type:"array"}),n=i.SheetNames.at(0),a=i.Sheets[n];s(K.P6.sheet_to_json(a))},r.onerror=e=>{t(e)},r.readAsArrayBuffer(e)})),i=Object.keys(r[0]).map(e=>({fieldName:e,fieldType:Number.isInteger(r[0][e])||Number.isFinite(r[0][e])?"number":"text"}));if(!n)return C(r,{onSuccess:()=>{O({fields:i},{onSuccess:()=>{u.resetFields(),z(void 0),t(!1)}})}});let a=n.map(e=>e.fieldName),l=Object.keys(r[0]),c=a.every(e=>l.includes(e)),o=l.every(e=>a.includes(e));if(!c||!o)return t(!1),z({data:r,templateFields:i}),j();A(r,{onSuccess:()=>{u.resetFields(),t(!1)}})},children:"确定"})]}),children:(0,r.jsx)("div",{className:"w-[80%] h-[40%] mt-8 mx-auto",children:(0,r.jsx)(f.Z,{form:u,children:(0,r.jsx)(f.Z.Item,{name:"file",rules:[{required:!0,message:"请选择Excel文件"}],valuePropName:"fileList",getValueFromEvent:e=>Array.isArray(e)?e:null==e?void 0:e.fileList,children:(0,r.jsxs)(L.Z,{beforeUpload:e=>(d([e]),!1),fileList:o,maxCount:1,accept:"xlsx,xls",children:[(0,r.jsx)("p",{className:"ant-upload-drag-icon",children:(0,r.jsx)(T.Z,{})}),(0,r.jsx)("p",{className:"ant-upload-text",children:"选择或拖拽Excel文件"}),(0,r.jsx)("p",{className:"ant-upload-hint",children:"一次只能导入一个文件"})]})})})})}),(0,r.jsx)(N.R,{isOpen:x,onOpenChange:p,children:(0,r.jsx)(w.A,{children:e=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(S.k,{className:"flex flex-col gap-1",children:"警告"}),(0,r.jsx)(k.I,{children:(0,r.jsx)("p",{children:"数据不兼容，确定继续导入吗？这将会清空原来的数据"})}),(0,r.jsxs)(b.R,{children:[(0,r.jsx)(l.A,{color:"danger",variant:"light",onPress:()=>{e(),u.resetFields()},children:"取消"}),(0,r.jsx)(l.A,{color:"primary",onPress:()=>{g.getQueryData(["/default/".concat(c)]),C(null==P?void 0:P.data,{onSuccess:()=>{O({fields:null==P?void 0:P.templateFields},{onSuccess:()=>{e(),u.resetFields(),z(void 0)}})}})},children:"确认"})]})]})})})]})};function I(e){let{params:s}=e,{data:t,isLoading:g}=(0,u.a)({queryKey:["/default/".concat(s.id)],select:e=>e.data.fields}),{data:N,isLoading:w}=(0,u.a)({queryKey:["/dates/".concat(s.id)]}),S=(0,m.NL)(),{mutate:k}=(0,h.D)({mutationFn:e=>(0,i.s)("/dates/".concat(s.id,"/").concat(e),"delete")(null)}),{isOpen:Z,onOpenChange:b,onOpen:A}=(0,a.q)(),[E]=f.Z.useForm(),[q,O]=(0,F.useState)(!1),[P,K]=y.ZP.useMessage(),[T,L]=(0,F.useState)(),[I,Q]=(0,F.useState)(!1),D=(0,F.useMemo)(()=>{let e=[{key:"index".concat(s.id),title:"序号",render:(e,s,t)=>t+1},{key:"action".concat(s.id),title:"操作",width:200,render:(e,t,i)=>(0,r.jsxs)("div",{className:"flex items-center justify-around",children:[(0,r.jsx)(l.A,{size:"sm",color:"primary",onClick:()=>{E.setFieldsValue(t),L(t.id),O(!0)},children:"修改"}),(0,r.jsx)(j.Z,{title:"警告",description:"确定删除该数据吗？",okText:"Yes",cancelText:"No",onConfirm:()=>{k(t.id,{onSuccess(){S.invalidateQueries({queryKey:["/dates/".concat(s.id)]}),P.success("删除成功",1)},onError(e){P.error(e.message,1)}})},children:(0,r.jsx)(l.A,{size:"sm",color:"danger",children:"删除"})})]})}];if(t&&!((null==t?void 0:t.length)<=0))return e.splice(1,0,...t.map(e=>({key:e.fieldName,dataIndex:e.fieldName,sorter:"number"===e.fieldType?(e,s)=>e-s:void 0,title:e.fieldName}))),e},[s,t]);return(0,r.jsxs)("div",{children:[K,(0,r.jsxs)(c.w,{children:[(0,r.jsx)(o.u,{children:(0,r.jsx)(x.Z,{items:[{title:(0,r.jsx)(v(),{href:"/",children:(0,r.jsx)(n.Z,{})})},{title:(0,r.jsx)("span",{children:"数据列表"})}]})}),(0,r.jsxs)(d.G,{children:[(0,r.jsxs)("div",{className:"flex gap-4 mb-4",children:[(0,r.jsx)(l.A,{size:"sm",color:"primary",onClick:A,isLoading:g,children:"添加数据"}),(0,r.jsx)(l.A,{size:"sm",color:"primary",onClick:()=>Q(!0),children:"导入数据"})]}),(0,r.jsx)(p.Z,{columns:D,rowKey:e=>e.id,dataSource:N,loading:w,size:"small",pagination:{defaultPageSize:20}})]})]}),(0,r.jsx)(C,{isOpen:Z,onOpenChange:b,id:s.id,fields:t,form:E}),(0,r.jsx)(z,{id:s.id,form:E,updateId:T,open:q,setOpen:O,fields:t}),(0,r.jsx)(_,{open:I,setOpen:Q,id:s.id,fields:t})]})}}},function(e){e.O(0,[493,135,326,635,377,170,171,11,551,869,239,945,337,353,714,235,932,860,577,56,744],function(){return e(e.s=18403)}),_N_E=e.O()}]);
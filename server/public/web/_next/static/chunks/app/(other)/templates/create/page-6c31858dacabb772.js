(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[818],{90967:function(e,l,s){Promise.resolve().then(s.bind(s,33335))},33335:function(e,l,s){"use strict";s.r(l),s.d(l,{default:function(){return y}});var t=s(11403),a=s(9099),n=s(24494),i=s(49050),r=s(76867),d=s(5335),o=s(76554),c=e=>{let[l,s]=(0,d.u)({controlled:e.open}),[c]=a.Z.useForm(),[u,m]=(0,o.useState)("text");return(0,t.jsx)(i.Z,{open:l,title:"添加模版字段",okText:"添加",cancelText:"取消",onCancel:()=>{e.onChange(!1)},onOk:()=>{c.validateFields().then(()=>{c.submit()})},children:(0,t.jsxs)(a.Z,{form:c,layout:"vertical",name:"fieldForm",children:[(0,t.jsx)(a.Z.Item,{name:"fieldName",label:"字段名",rules:[{required:!0}],children:(0,t.jsx)(n.default,{})}),(0,t.jsx)(a.Z.Item,{name:"fieldType",label:"字段类型",rules:[{required:!0}],children:(0,t.jsx)(r.Z,{onChange:e=>{m(e)},options:[{value:"text",label:"字符串"},{value:"number",label:"数字"}]})}),(0,t.jsx)(a.Z.Item,{name:"defaultValue",label:"默认值",children:(0,t.jsx)(n.default,{type:u})})]})})},u=s(99409),m=s(48628),x=s(5536),h=s.n(x),p=s(6941),j=s(46866),f=s(769),Z=s(86631);let{TextArea:v}=n.default;async function b(e){let l=await fetch("".concat("http://localhost:4060","/templates"),{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await l.json()}var y=()=>{let[e]=a.Z.useForm(),[l,s]=(0,o.useState)(!1),[r,d]=(0,o.useState)(""),[x,y]=(0,o.useState)(""),g=async e=>{let l=URL.createObjectURL(e.originFileObj);d(l),s(!0),y(e.name||e.url.substring(e.url.lastIndexOf("/")+1))},[w,C]=(0,o.useState)(!1),F=(0,Z.useRouter)(),N=async()=>{let l=await e.validateFields();l.cover=l.cover[0].response.url[0],await b(l),F.push("/templates/")};return(0,t.jsxs)("div",{className:"mx-auto mt-5 w-2/5",children:[(0,t.jsxs)(a.Z.Provider,{onFormFinish:(e,l)=>{let{values:s,forms:t}=l;if("fieldForm"===e){let{template:e,fieldForm:l}=t,a=e.getFieldValue("fields")||[];e.setFieldsValue({fields:[...a,s]}),l.resetFields(),C(!1)}},children:[(0,t.jsxs)(a.Z,{name:"template",labelCol:{span:4},wrapperCol:{span:20},form:e,children:[(0,t.jsx)(a.Z.Item,{name:"name",label:"模版名称",rules:[{required:!0}],children:(0,t.jsx)(n.default,{})}),(0,t.jsx)(a.Z.Item,{name:"description",label:"模版描述",rules:[{required:!0}],children:(0,t.jsx)(v,{rows:3})}),(0,t.jsx)(a.Z.Item,{label:"模版封面",name:"cover",valuePropName:"fileList",getValueFromEvent:e=>Array.isArray(e)?e:null==e?void 0:e.fileList,children:(0,t.jsx)(f.Z,{action:"http://127.0.0.1:4060/upload",onPreview:g,accept:".png,.jpg,.jpeg,.webp",maxCount:1,listType:"picture-card",children:(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Z,{}),(0,t.jsx)("div",{style:{marginTop:8},children:"Upload"})]})})}),(0,t.jsx)(a.Z.Item,{name:"fields",hidden:!0}),(0,t.jsx)(a.Z.Item,{label:"模版字段",shouldUpdate:(e,l)=>e.fields!==l.fields,children:e=>{let{getFieldValue:l,setFieldsValue:s}=e,a=l("fields")||[];return a.length>0?(0,t.jsx)("div",{className:"flex flex-col gap-3",children:a.map((e,l)=>(0,t.jsxs)("div",{className:"gap-3 flex flex-row",children:[(0,t.jsx)(p.Z,{color:"success",children:e.fieldName}),(0,t.jsx)(p.Z,{color:"cyan",children:e.fieldType}),e.defaultValue&&(0,t.jsx)(p.Z,{color:"orange",children:e.defaultValue}),(0,t.jsx)(h(),{size:"small",danger:!0,onClick:()=>{s({fields:a.filter((e,s)=>s!==l)})},color:"danger",children:"删除"})]},l))}):(0,t.jsxs)(j.Z.Text,{type:"secondary",children:["( ",(0,t.jsx)(m.Z,{})," 暂时没有模版字段 )"]})}}),(0,t.jsx)("div",{className:"w-56 mx-auto",children:(0,t.jsx)(h(),{type:"dashed",onClick:()=>{C(!0)},block:!0,icon:(0,t.jsx)(u.Z,{}),children:"添加模版字段"})}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsx)(h(),{block:!0,type:"primary",onClick:N,children:"添加模版"})})]}),(0,t.jsx)(c,{open:w,onChange:C})]}),(0,t.jsx)(i.Z,{open:l,title:x,footer:null,onCancel:()=>{d(""),s(!1),y("")},children:(0,t.jsx)("img",{alt:"example",style:{width:"100%"},src:r})})]})}}},function(e){e.O(0,[935,392,58,442,744],function(){return e(e.s=90967)}),_N_E=e.O()}]);
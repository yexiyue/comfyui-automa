(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[907],{6378:function(e,l,t){Promise.resolve().then(t.bind(t,82014))},82014:function(e,l,t){"use strict";t.r(l);var a=t(11403),s=t(59196),n=t(99409),i=t(48628),r=t(77538),d=t.n(r),o=t(94553),c=t(42078),u=t(86144),m=t(3373),h=t(9678),x=t(18722),p=t(86631),f=t(76554);let{TextArea:j}=c.default;async function v(e,l){let t=await fetch("".concat("http://localhost:4060","/templates/").concat(l),{method:"put",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await t.json()}l.default=e=>{let{params:l}=e,[t]=o.Z.useForm(),[r,Z]=(0,f.useState)(!1),[y,b]=(0,f.useState)(""),[g,C]=(0,f.useState)(""),[w,F]=(0,f.useState)(""),N=async e=>{if(e.url)b(e.url);else{let l=URL.createObjectURL(e.originFileObj);b(l)}Z(!0),C(e.name||e.url.substring(e.url.lastIndexOf("/")+1))};(0,f.useEffect)(()=>{fetch("".concat("http://localhost:4060","/templates/").concat(l.id)).then(e=>e.json()).then(e=>{if(e.data.cover){F(e.data.cover);let l=e.data.cover.split("/");e.data.cover=[{uid:-1,name:l[l.length-1],status:"done",url:e.data.cover}]}t.setFieldsValue(e.data)})},[]);let[k,I]=(0,f.useState)(!1),T=(0,p.useRouter)(),O=async()=>{var e,a,s,n;let i=await t.validateFields();i.cover=(null===(n=i.cover)||void 0===n?void 0:null===(s=n[0])||void 0===s?void 0:null===(a=s.response)||void 0===a?void 0:null===(e=a.url)||void 0===e?void 0:e[0])||w||"",await v(i,l.id),T.push("/templates/")};return(0,a.jsxs)("div",{className:"mx-auto mt-5 w-2/5",children:[(0,a.jsxs)(o.Z.Provider,{onFormFinish:(e,l)=>{let{values:t,forms:a}=l;if("fieldForm"===e){let{template:e,fieldForm:l}=a,s=e.getFieldValue("fields")||[];e.setFieldsValue({fields:[...s,t]}),l.resetFields(),I(!1)}},children:[(0,a.jsxs)(o.Z,{name:"template",labelCol:{span:4},wrapperCol:{span:20},form:t,children:[(0,a.jsx)(o.Z.Item,{name:"name",label:"模版名称",rules:[{required:!0}],children:(0,a.jsx)(c.default,{})}),(0,a.jsx)(o.Z.Item,{name:"description",label:"模版描述",rules:[{required:!0}],children:(0,a.jsx)(j,{rows:3})}),(0,a.jsx)(o.Z.Item,{label:"模版封面",name:"cover",valuePropName:"fileList",getValueFromEvent:e=>Array.isArray(e)?e:null==e?void 0:e.fileList,children:(0,a.jsx)(x.Z,{action:"".concat("http://localhost:4060","/upload"),onPreview:N,accept:".png,.jpg,.jpeg,.webp",maxCount:1,listType:"picture-card",children:(0,a.jsxs)("div",{children:[(0,a.jsx)(n.Z,{}),(0,a.jsx)("div",{style:{marginTop:8},children:"Upload"})]})})}),(0,a.jsx)(o.Z.Item,{name:"fields",hidden:!0}),(0,a.jsx)(o.Z.Item,{label:"模版字段",shouldUpdate:(e,l)=>e.fields!==l.fields,children:e=>{let{getFieldValue:l,setFieldsValue:t}=e,s=l("fields")||[];return s.length>0?(0,a.jsx)("div",{className:"flex flex-col gap-3",children:s.map((e,l)=>(0,a.jsxs)("div",{className:"gap-3 flex flex-row",children:[(0,a.jsx)(m.Z,{color:"success",children:e.fieldName}),(0,a.jsx)(m.Z,{color:"cyan",children:e.fieldType}),e.defaultValue&&(0,a.jsx)(m.Z,{color:"orange",children:e.defaultValue}),(0,a.jsx)(d(),{size:"small",danger:!0,onClick:()=>{t({fields:s.filter((e,t)=>t!==l)})},color:"danger",children:"删除"})]},e.fieldName+l))}):(0,a.jsxs)(h.Z.Text,{type:"secondary",children:["( ",(0,a.jsx)(i.Z,{})," 暂时没有模版字段 )"]})}}),(0,a.jsx)("div",{className:"w-56 mx-auto",children:(0,a.jsx)(d(),{type:"dashed",onClick:()=>{I(!0)},block:!0,icon:(0,a.jsx)(n.Z,{}),children:"添加模版字段"})}),(0,a.jsxs)("div",{className:"mt-6 flex justify-around",children:[(0,a.jsx)(d(),{type:"primary",onClick:T.back,children:"取消"}),(0,a.jsx)(d(),{type:"primary",onClick:O,children:"更新模版"})]})]}),(0,a.jsx)(s.Z,{open:k,onChange:I})]}),(0,a.jsx)(u.Z,{open:r,title:g,footer:null,onCancel:()=>{b(""),Z(!1),C("")},children:(0,a.jsx)("img",{alt:"example",style:{width:"100%"},src:y})})]})}},59196:function(e,l,t){"use strict";var a=t(11403),s=t(94553),n=t(42078),i=t(86144),r=t(95322),d=t(5335),o=t(76554);l.Z=e=>{let[l,t]=(0,d.u)({controlled:e.open}),[c]=s.Z.useForm(),[u,m]=(0,o.useState)("text");return(0,a.jsx)(i.Z,{open:l,title:"添加模版字段",okText:"添加",cancelText:"取消",onCancel:()=>{e.onChange(!1)},onOk:()=>{c.validateFields().then(()=>{c.submit()})},children:(0,a.jsxs)(s.Z,{form:c,layout:"vertical",name:"fieldForm",children:[(0,a.jsx)(s.Z.Item,{name:"fieldName",label:"字段名",rules:[{required:!0}],children:(0,a.jsx)(n.default,{})}),(0,a.jsx)(s.Z.Item,{name:"fieldType",label:"字段类型",rules:[{required:!0}],children:(0,a.jsx)(r.Z,{onChange:e=>{m(e)},options:[{value:"text",label:"字符串"},{value:"number",label:"数字"}]})}),(0,a.jsx)(s.Z.Item,{name:"defaultValue",label:"默认值",children:(0,a.jsx)(n.default,{type:u})})]})})}}},function(e){e.O(0,[937,354,581,58,442,744],function(){return e(e.s=6378)}),_N_E=e.O()}]);
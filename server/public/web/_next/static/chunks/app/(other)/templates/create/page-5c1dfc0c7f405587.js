(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[818],{71117:function(e,l,t){Promise.resolve().then(t.bind(t,78135))},58075:function(e,l,t){"use strict";t.d(l,{R:function(){return r},s:function(){return s}});let r=async e=>{let{queryKey:l}=e;try{let e=await fetch("".concat("http://localhost:4060").concat(l[0]));if(!e.ok)throw Error("Something went wrong ".concat(l[0]));return await e.json()}catch(e){throw Error(e)}},s=(e,l)=>async t=>{try{let r=await fetch("".concat("http://localhost:4060").concat(e),{method:l,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw Error("Something went wrong ".concat(l," ").concat(e));return await r.json()}catch(e){throw Error(e)}}},78135:function(e,l,t){"use strict";t.r(l);var r=t(33584),s=t(33192),n=t(58e3),a=t(4053),i=t(19816),o=t.n(i),c=t(67930),d=t(20581),u=t(93527),h=t(23186),m=t(27979),x=t(77722),f=t(28938),p=t(47991),j=t(13920),g=t(65325),v=t(58075);let{TextArea:Z}=d.default;l.default=()=>{let[e,l]=f.ZP.useMessage(),{mutate:t}=(0,g.D)({mutationFn:(0,v.s)("/templates","post")}),[i]=c.Z.useForm(),[w,y]=(0,j.useState)(!1),[b,C]=(0,j.useState)(""),[F,k]=(0,j.useState)(""),N=async e=>{let l=URL.createObjectURL(e.originFileObj);C(l),y(!0),k(e.name||e.url.substring(e.url.lastIndexOf("/")+1))},[E,I]=(0,j.useState)(!1),S=(0,p.useRouter)(),T=async()=>{let l=await i.validateFields();l.cover?l.cover=l.cover[0].response.url[0]:l.cover="/web/default.png",t(l,{onSuccess:()=>{e.success("添加成功",1).then(()=>{S.push("/templates/")})},onError(l){e.error(l.message,1)}})};return(0,r.jsxs)("div",{className:"mx-auto mt-5 w-2/5",children:[l,(0,r.jsxs)(c.Z.Provider,{onFormFinish:(e,l)=>{let{values:t,forms:r}=l;if("fieldForm"===e){let{template:e,fieldForm:l}=r,s=e.getFieldValue("fields")||[];e.setFieldsValue({fields:[...s,t]}),l.resetFields(),I(!1)}},children:[(0,r.jsxs)(c.Z,{name:"template",labelCol:{span:4},wrapperCol:{span:20},form:i,children:[(0,r.jsx)(c.Z.Item,{name:"name",label:"模版名称",rules:[{required:!0}],children:(0,r.jsx)(d.default,{})}),(0,r.jsx)(c.Z.Item,{name:"description",label:"模版描述",rules:[{required:!0}],children:(0,r.jsx)(Z,{rows:3})}),(0,r.jsx)(c.Z.Item,{label:"模版封面",name:"cover",valuePropName:"fileList",getValueFromEvent:e=>Array.isArray(e)?e:null==e?void 0:e.fileList,children:(0,r.jsx)(x.default,{action:"".concat("http://localhost:4060","/upload"),onPreview:N,accept:".png,.jpg,.jpeg,.webp",maxCount:1,listType:"picture-card",children:(0,r.jsxs)("div",{children:[(0,r.jsx)(n.Z,{}),(0,r.jsx)("div",{style:{marginTop:8},children:"上传图片"})]})})}),(0,r.jsx)(c.Z.Item,{name:"fields",hidden:!0}),(0,r.jsx)(c.Z.Item,{label:"模版字段",shouldUpdate:(e,l)=>e.fields!==l.fields,rules:[{required:!0}],children:e=>{let{getFieldValue:l,setFieldsValue:t}=e,s=l("fields")||[];return s.length>0?(0,r.jsx)("div",{className:"flex flex-col gap-3",children:s.map((e,l)=>(0,r.jsxs)("div",{className:"gap-3 flex flex-row",children:[(0,r.jsx)(h.Z,{color:"success",children:e.fieldName}),(0,r.jsx)(h.Z,{color:"cyan",children:e.fieldType}),e.defaultValue&&(0,r.jsx)(h.Z,{color:"orange",children:e.defaultValue}),(0,r.jsx)(o(),{size:"small",danger:!0,onClick:()=>{t({fields:s.filter((e,t)=>t!==l)})},color:"danger",children:"删除"})]},l))}):(0,r.jsxs)(m.Z.Text,{type:"secondary",children:["( ",(0,r.jsx)(a.Z,{})," 暂时没有模版字段 )"]})}}),(0,r.jsx)("div",{className:"w-56 mx-auto",children:(0,r.jsx)(o(),{type:"dashed",onClick:()=>{I(!0)},block:!0,icon:(0,r.jsx)(n.Z,{}),children:"添加模版字段"})}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)(o(),{block:!0,type:"primary",onClick:T,children:"添加模版"})})]}),(0,r.jsx)(s.Z,{open:E,onChange:I})]}),(0,r.jsx)(u.Z,{open:w,title:F,footer:null,onCancel:()=>{C(""),y(!1),k("")},children:(0,r.jsx)("img",{alt:"example",style:{width:"100%"},src:b})})]})}},33192:function(e,l,t){"use strict";var r=t(33584),s=t(67930),n=t(20581),a=t(93527),i=t(87337),o=t(39085),c=t(13920);l.Z=e=>{let[l,t]=(0,o.u)({controlled:e.open}),[d]=s.Z.useForm(),[u,h]=(0,c.useState)("text");return(0,r.jsx)(a.Z,{open:l,title:"添加模版字段",okText:"添加",cancelText:"取消",onCancel:()=>{e.onChange(!1)},onOk:()=>{d.validateFields().then(()=>{d.submit()})},children:(0,r.jsxs)(s.Z,{form:d,layout:"vertical",name:"fieldForm",children:[(0,r.jsx)(s.Z.Item,{name:"fieldName",label:"字段名",rules:[{required:!0}],children:(0,r.jsx)(n.default,{})}),(0,r.jsx)(s.Z.Item,{name:"fieldType",label:"字段类型",rules:[{required:!0}],children:(0,r.jsx)(i.default,{onChange:e=>{h(e)},options:[{value:"text",label:"字符串"},{value:"number",label:"数字"}]})}),(0,r.jsx)(s.Z.Item,{name:"defaultValue",label:"默认值",children:(0,r.jsx)(n.default,{type:u})})]})})}}},function(e){e.O(0,[135,170,171,11,869,945,722,337,940,638,577,56,744],function(){return e(e.s=71117)}),_N_E=e.O()}]);